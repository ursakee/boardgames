import{c as N,r as y,j as e,g as I,d as A}from"./index-B37KDAax.js";import{X as S}from"./x-g7291X5g.js";import{u as B,L as E,P as R,H as W}from"./useGameSession-OfLS0_C2.js";import{A as D}from"./arrow-left-C3My9cQf.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],M=N("circle-check",H);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],w=N("circle-x",O);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],C=N("eye",J);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}]],Y=N("rectangle-horizontal",V);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],X=N("settings",q),K=({puzzle:a,gridState:d,setGridState:c,isInteractable:u})=>{const{clues:x}=a,r=(n,o)=>{u&&c(s=>{if(!s)return null;const l=s.map(b=>[...b.map(i=>i?[...i]:null)]),t=l[n][o]||[];if(t.some(b=>b.isFixedTrain)||!t.some(b=>b.trackId))return s;const h=t.findIndex(b=>b.isUserPlacedTrain);return h>-1?t.splice(h,1):t.push({isUserPlacedTrain:!0}),l[n][o]=t,l})},m=(n,o,s)=>{n.preventDefault(),u&&c(l=>{if(!l)return null;const t=l.map(i=>[...i.map(p=>p?[...p]:null)]),h=t[o][s]||[];if(h.some(i=>i.isFixedTrain))return l;const b=h.findIndex(i=>i.isMarked);return b>-1?h.splice(b,1):h.push({isMarked:!0}),t[o][s]=h,t})};return e.jsx("div",{className:"bg-slate-900/50 p-3 rounded-lg select-none",children:e.jsxs("table",{className:"border-collapse mx-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),x.columnClues.map((n,o)=>e.jsx("th",{className:"text-2xl font-bold text-slate-300 text-center align-middle pb-1",children:n},o))]})}),e.jsx("tbody",{children:d.map((n,o)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-2xl font-bold text-slate-300 text-right pr-2",children:x.rowClues[o]}),n.map((s,l)=>e.jsx("td",{onClick:()=>r(o,l),onContextMenu:t=>m(t,o,l),className:"w-16 h-16 bg-slate-700 border-2 border-slate-600 relative",style:{cursor:u?"pointer":"not-allowed"},children:Q(s)},l))]},o))})]})})};function Q(a){if(!a)return null;const d=a.filter(r=>r.connections),c=a.some(r=>r.isFixedTrain),u=a.some(r=>r.isUserPlacedTrain),x=a.some(r=>r.isMarked);return e.jsxs(e.Fragment,{children:[d.map((r,m)=>e.jsx("svg",{viewBox:"0 0 100 100",className:"absolute w-full h-full top-0 left-0",children:e.jsx("path",{d:I(r.connections),stroke:r.color,strokeWidth:"10",fill:"none",strokeLinecap:"round"})},m)),(c||u)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`w-3/5 h-3/5 ${c?"bg-slate-500":"bg-slate-100"} rounded-sm`})}),x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-red-400",children:e.jsx(S,{size:50,strokeWidth:3})})]})}const Z=y.memo(K),ee=({tracks:a,trains:d,fixedTrainId:c})=>{const[u,x]=y.useState(new Set);y.useEffect(()=>{x(new Set)},[d]);const r=s=>a.find(l=>l.trackId===s)?.color||"gray",m=s=>{s!==c&&x(l=>{const t=new Set(l);return t.has(s)?t.delete(s):t.add(s),t})},n=s=>c===s||u.has(s),o=[...d].sort((s,l)=>{const t=r(s.trackId),h=r(l.trackId);return t<h?-1:t>h?1:l.carsCount-s.carsCount});return e.jsx("div",{className:"space-y-1",children:o.map(s=>e.jsxs("div",{onClick:()=>m(s.trainId),className:`relative p-1 rounded-md ${s.trainId!==c?"cursor-pointer hover:bg-slate-700/50":""}`,children:[e.jsx("div",{className:"flex items-center",children:Array.from({length:s.carsCount}).map((l,t)=>e.jsx(Y,{className:"w-8 h-8",stroke:r(s.trackId),strokeWidth:n(s.trainId)?1:2,fill:n(s.trainId)?"transparent":r(s.trackId)},t))}),n(s.trainId)&&e.jsx("div",{className:"absolute top-1/2 left-1 -translate-y-1/2 h-0.5 bg-red-400",style:{width:`${s.carsCount*2}rem`}})]},s.trainId))})};function se(a){if(!a)return null;const d=a.filter(r=>r.connections),c=a.some(r=>r.isFixedTrain),u=a.some(r=>r.isUserPlacedTrain),x=a.some(r=>r.isMarked);return e.jsxs(e.Fragment,{children:[d.map((r,m)=>e.jsx("svg",{viewBox:"0 0 100 100",className:"absolute w-full h-full top-0 left-0",children:e.jsx("path",{d:I(r.connections),stroke:r.color,strokeWidth:"10",fill:"none",strokeLinecap:"round"})},m)),(c||u)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`w-3/5 h-3/5 ${c?"bg-slate-500":"bg-slate-100"} rounded-sm`})}),x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-red-400",children:e.jsx(S,{size:30,strokeWidth:3})})]})}const z=({title:a,puzzle:d,gridState:c,comparisonGrid:u})=>{const{clues:x}=d,r=(m,n)=>{if(!u)return"correct";const o=c[m]?.[n]?.some(l=>l.isUserPlacedTrain||l.isFixedTrain)??!1,s=u[m]?.[n]?.some(l=>l.isUserPlacedTrain||l.isFixedTrain)??!1;return o&&!s?"extra":!o&&s?"missed":"correct"};return e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-200 mb-3",children:a}),e.jsx("div",{className:"bg-slate-900/50 p-2 rounded-lg select-none",children:e.jsxs("table",{className:"border-collapse mx-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),x.columnClues.map((m,n)=>e.jsx("th",{className:"text-lg font-bold text-slate-300 text-center align-middle pb-1 h-8 w-8",children:m},n))]})}),e.jsx("tbody",{children:c.map((m,n)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-lg font-bold text-slate-300 text-right pr-2 h-8 w-8",children:x.rowClues[n]}),m.map((o,s)=>{const l=r(n,s);return e.jsxs("td",{className:"w-8 h-8 md:w-10 md:h-10 bg-slate-700 border-2 border-slate-600 relative",children:[se(o),l==="extra"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-500/40",children:e.jsx(w,{className:"text-red-300",size:24})}),l==="missed"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-green-500/40",children:e.jsx(M,{className:"text-green-300",size:24})})]},s)})]},n))})]})})]})},te=({puzzle:a,playerGrid:d,solutionGrid:c,onClose:u})=>e.jsxs("div",{className:"fixed inset-0 bg-slate-900/90 backdrop-blur-sm z-20 flex flex-col items-center justify-center p-4 animate-in fade-in",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-4xl font-bold text-yellow-400",children:"Review Solution"}),e.jsx("p",{className:"text-slate-400 mt-2",children:"Compare your submission with the correct solution."}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 text-sm text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"text-red-300",size:18})," Incorrect Placement"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"text-green-300",size:18})," Missed Placement"]})]})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row items-start gap-6 lg:gap-10",children:[e.jsx(z,{title:"Your Submission",puzzle:a,gridState:d,comparisonGrid:c}),e.jsx(z,{title:"Correct Solution",puzzle:a,gridState:c})]}),e.jsxs("button",{onClick:u,className:"mt-8 flex items-center justify-center gap-2 px-6 py-3 font-semibold text-slate-100 bg-cyan-600 rounded-lg hover:bg-cyan-500 transition-colors",children:[e.jsx(D,{size:20})," Go Back"]})]}),ie=({gameState:a,isGameOver:d,onPerformAction:c,onLeaveGame:u})=>{const{localPlayer:x,isHost:r,startGame:m,gameOptions:n,setGameOptions:o,gameInfo:s,returnToLobby:l}=B(),{puzzle:t,playerStates:h,winner:b}=a,i=x?h[x.id]:null,[p,v]=y.useState(null),[P,k]=y.useState(!1),L=y.useMemo(()=>t?JSON.stringify(t.tracks):null,[t]);y.useEffect(()=>{if(k(!1),t&&i){const f=Array(t.grid.rows).fill(null).map(()=>Array(t.grid.columns).fill(null));t.tracks.forEach(j=>{j.path.forEach(g=>{f[g.row][g.col]||(f[g.row][g.col]=[]),f[g.row][g.col].push({trackId:j.trackId,color:j.color,connections:A(g,j.path)})})});const T=t.trains.find(j=>j.trainId===i.fixedTrainId);T&&T.carPositions.forEach(j=>{f[j.row][j.col]||(f[j.row][j.col]=[]),f[j.row][j.col].push({isFixedTrain:!0})}),v(f)}},[L,i?.fixedTrainId]);const _=()=>{p&&!i?.submitted&&c({type:"SUBMIT_SOLUTION",payload:p})};if(P&&i?.submittedGrid&&a.solution)return e.jsx(te,{puzzle:t,playerGrid:JSON.parse(i.submittedGrid),solutionGrid:JSON.parse(a.solution),onClose:()=>k(!1)});if(!t||!p||!i||!x)return e.jsx(E,{className:"animate-spin h-12 w-12 text-cyan-400"});const F=()=>d?b===x.id?{message:"You Win!",color:"text-green-400"}:b?{message:"You Lose!",color:"text-red-400"}:{message:"It's a Draw!",color:"text-slate-300"}:{message:"",color:""},{message:G,color:U}=F(),$=i.submissionResult==="incorrect"&&!d;return e.jsxs("div",{className:"fixed inset-0 flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-8 p-4 bg-slate-800/50 rounded-2xl border border-slate-700/50 relative",children:[$&&e.jsxs("div",{className:"absolute inset-0 bg-slate-900/80 backdrop-blur-sm z-10 flex flex-col items-center justify-center rounded-2xl",children:[e.jsx(w,{className:"h-20 w-20 text-yellow-400 mb-4"}),e.jsx("h2",{className:"text-4xl font-bold text-yellow-400",children:"Incorrect Solution"}),e.jsx("p",{className:"mt-2 text-slate-300",children:"Waiting for other players to finish..."}),e.jsxs("button",{onClick:()=>k(!0),className:"mt-6 flex items-center justify-center gap-2 px-5 py-2.5 font-semibold text-slate-100 bg-slate-600/80 rounded-lg hover:bg-slate-600 transition-colors",children:[e.jsx(C,{size:18})," See Mistakes"]})]}),e.jsxs("div",{className:"w-full md:w-56 p-4 bg-slate-800 rounded-xl space-y-4 self-stretch flex flex-col",children:[e.jsx("h3",{className:"text-xl font-bold text-center text-slate-200 border-b border-slate-600 pb-2",children:"Available Trains"}),e.jsx("div",{className:"flex-grow",children:e.jsx(ee,{tracks:t.tracks,trains:t.trains,fixedTrainId:i.fixedTrainId})}),e.jsx("button",{onClick:_,disabled:d||i.submitted,className:"w-full px-4 py-2 font-bold text-slate-900 bg-green-500 rounded-lg hover:bg-green-400 transition disabled:bg-slate-600 disabled:cursor-not-allowed",children:"Submit Solution"}),e.jsx("button",{onClick:u,className:"w-full px-4 py-2 font-semibold text-slate-300 bg-red-800/50 rounded-lg hover:bg-red-700/80",children:"Leave Game"})]}),e.jsx("div",{className:"flex-grow flex items-center justify-center",children:e.jsx(Z,{puzzle:t,gridState:p,setGridState:v,fixedTrainId:i.fixedTrainId,isInteractable:!d&&!i.submitted})})]}),d&&e.jsx("div",{className:"absolute inset-0 bg-slate-900/90 backdrop-blur-sm flex flex-col items-center justify-center transition-opacity duration-300 animate-in fade-in",children:e.jsxs("div",{className:"text-center p-6 bg-slate-800/80 rounded-2xl border border-slate-700 shadow-xl",children:[e.jsx("h2",{className:`text-6xl font-black ${U}`,children:G}),i.submissionResult==="incorrect"&&e.jsxs("button",{onClick:()=>k(!0),className:"mt-6 flex items-center justify-center gap-2 px-5 py-2.5 font-semibold text-slate-100 bg-slate-600/80 rounded-lg hover:bg-slate-600 transition-colors",children:[e.jsx(C,{size:18})," Review Mistakes"]}),r&&e.jsxs("div",{className:"mt-8 flex flex-col items-center gap-4 w-64 mx-auto",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("label",{className:"flex items-center justify-center gap-2 text-sm font-semibold text-slate-400 mb-2",children:[e.jsx(X,{size:16})," Difficulty"]}),e.jsx("select",{value:n.difficulty,onChange:f=>o({difficulty:f.target.value}),className:"w-full px-3 py-2 text-center text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500",children:s?.gameOptions?.find(f=>f.id==="difficulty")?.choices?.map(f=>e.jsx("option",{value:f.value,children:f.label},f.value))})]}),e.jsxs("button",{onClick:m,className:"w-full flex items-center justify-center gap-2 px-6 py-3 font-semibold text-slate-900 bg-cyan-400 rounded-lg hover:bg-cyan-300 transition-colors",children:[e.jsx(R,{size:20})," Play Again"]}),e.jsxs("button",{onClick:l,className:"w-full flex items-center justify-center gap-2 px-6 py-2 font-semibold text-slate-300 bg-slate-700/50 rounded-lg hover:bg-slate-700 transition-colors",children:[e.jsx(W,{size:18})," Back to Lobby"]})]}),!r&&e.jsx("p",{className:"mt-8 text-slate-300",children:"Waiting for host to start the next game..."})]})})]})};export{ie as default};
