import{c as U,b as q,u as Q,r as o,a as X,j as e}from"./index-BBxjmWmB.js";import E from"./TicTacToeBoard-oyPRw6uk.js";import{u as Z,L as A,P as $,H as ee}from"./useGameSession-CTfiQRTB.js";import{S as se,C as te,a as ae,U as ne}from"./users-CMFyLxUt.js";import{S as le}from"./swords-DrSTL4j2.js";import{L as re}from"./log-out-CxCj6h7H.js";import"./x-BjcpBwhR.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],oe=U("shield",ie);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],de=U("wifi-off",ce),ye=()=>{const{gameName:c,gameId:v}=q(),x=Q(),[N,w]=o.useState(!1),[M,k]=o.useState(!1),{gameId:p,gameInfo:r,gamePhase:b,gameState:l,gameEngine:f,gameOptions:W,players:d,localPlayer:a,isHost:g,peerConnectionStates:y,joinGame:C,leaveGame:G,setMyUsername:D,setGameOptions:_,startGame:L,returnToLobby:F,performAction:S,resetSession:T}=Z(),[h,O]=o.useState(a?.username||""),[R,j]=o.useState(null),P=X(s=>s.disconnectionMessage);o.useEffect(()=>{a?.username&&O(a.username)},[a?.username]),o.useEffect(()=>{(async()=>{v&&c&&!p&&!N&&await C(v,c)==="failed"&&x(`/game/${c}`,{replace:!0})})()},[v,c,p,C,N,x]),o.useEffect(()=>{P&&p&&(x(`/game/${c}`,{replace:!0}),T())},[P,p,c,x,T]);const u=o.useMemo(()=>{if(!f||!l||!a)return{message:"",isGameOver:!1,isMyTurn:!1};const s=f.isTurnOf(l,a.id),t=f.getGameStatus(l,d),n=f.isGameOver(l);return{message:t,isGameOver:n,isMyTurn:s}},[l,f,d,a]);o.useEffect(()=>{if(b!=="in-game"||!l||u.isGameOver){j(null);return}const s=l.options?.turnTimer;if(s<=0){j(null);return}j(s);const t=setInterval(()=>{j(n=>{if(n===null||n<=1){if(clearInterval(t),u.isMyTurn){const m=l.board.map((i,K)=>i===null?K:null).filter(i=>i!==null);if(m.length>0){const i=m[Math.floor(Math.random()*m.length)];S({type:"MAKE_MOVE",payload:i})}}return null}return n-1})},1e3);return()=>clearInterval(t)},[l?.isNext,b,u.isGameOver]);const z=async()=>{w(!0),await G(),x(`/game/${c}`,{replace:!0})},Y=async()=>{w(!0),await G(),x(`/game/${c}`,{replace:!0})},I=()=>{h.trim()&&h.trim()!==a?.username&&D(h.trim())},H=(s,t)=>{const n=/^\d+$/.test(t)?Number(t):t;_({[s]:n})},J=()=>{navigator.clipboard.writeText(window.location.href).then(()=>{k(!0),setTimeout(()=>k(!1),2e3)})},V=o.useMemo(()=>{if(!r||d.length<r.minPlayers)return!1;if(!g)return y.get("p1")==="connected";const s=d.filter(t=>t.id!==a?.id).map(t=>t.id);return s.length===0&&r.minPlayers>1?!1:s.every(t=>y.get(t)==="connected")},[d,r,g,a,y]),B=()=>{if(!r)return null;if(Array.from(y.values()).some(n=>n==="connecting"))return e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-cyan-400 p-2",children:[e.jsx(A,{className:"animate-spin",size:16})," Connecting to player..."]});const t=Array.from(y.values()).some(n=>n==="disconnected"||n==="failed");return d.length<r.minPlayers&&t?e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-red-400 p-2",children:[e.jsx(de,{size:16})," Player disconnected. Waiting for a new player."]}):d.length<r.minPlayers?e.jsx("div",{className:"text-center text-sm text-slate-400 p-2",children:"Waiting for another player..."}):null};if(!p||!r||!a||!f)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen",children:[e.jsx(A,{className:"animate-spin h-12 w-12 text-cyan-400"}),e.jsx("p",{className:"mt-4 text-xl text-slate-300",children:"Joining Game..."})]});if(b==="post-game"){const{winner:s,playerMap:t}=l,n=t[a.id];let m="",i="text-white";return s==="draw"?(m="It's a Draw!",i="text-yellow-400"):s===n?(m="You Win!",i="text-green-400"):(m="You Lose!",i="text-red-400"),e.jsxs("div",{className:"relative w-full flex items-center justify-center",children:[e.jsx(E,{gameState:l,statusMessage:u.message,isGameOver:!0,isMyTurn:!1,turnTimeLeft:null,onPerformAction:()=>{},onLeaveGame:z}),e.jsx("div",{className:"absolute inset-0 bg-slate-900/90 backdrop-blur-sm flex flex-col items-center justify-center transition-opacity duration-300 animate-in fade-in",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:`text-6xl font-black ${i}`,children:m}),g&&e.jsxs("div",{className:"mt-8 flex gap-4",children:[e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 font-semibold text-slate-900 bg-cyan-400 rounded-lg hover:bg-cyan-300 transition-transform hover:scale-105",children:[e.jsx($,{size:20})," Play Again"]}),e.jsxs("button",{onClick:F,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 font-semibold text-slate-300 bg-slate-700 rounded-lg hover:bg-slate-600 transition",children:[e.jsx(ee,{size:20})," Back to Lobby"]})]}),!g&&e.jsx("p",{className:"mt-8 text-slate-300",children:"Waiting for the host to start the next round..."})]})})]})}return b==="in-game"?e.jsx(E,{gameState:l,statusMessage:u.message,isGameOver:u.isGameOver,isMyTurn:u.isMyTurn,turnTimeLeft:R,onPerformAction:S,onLeaveGame:z}):e.jsxs("div",{className:"w-full max-w-2xl p-6 md:p-8 space-y-6 bg-slate-800 rounded-2xl shadow-2xl shadow-slate-950/50 border border-slate-700",children:[e.jsx("div",{className:"text-center border-b border-slate-700 pb-4",children:e.jsxs("h2",{className:"text-3xl font-bold text-white",children:[" ",r.displayName," Lobby "]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-x-8 gap-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-slate-300",children:"Your Settings"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"username",className:"text-sm font-medium text-slate-400",children:"Display Name"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"username",type:"text",value:h,onChange:s=>O(s.target.value),onKeyDown:s=>s.key==="Enter"&&I(),className:"flex-grow px-3 py-2 text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Enter your name..."}),e.jsx("button",{onClick:I,disabled:h.trim()===""||h.trim()===a.username,className:"p-2 text-slate-300 bg-slate-700/50 rounded-md hover:bg-slate-700 disabled:bg-slate-600 disabled:text-slate-500 disabled:cursor-not-allowed transition-colors",children:e.jsx(se,{size:20})})]})]}),e.jsx("button",{onClick:J,className:`w-full flex items-center justify-center gap-2 px-4 py-2 font-semibold rounded-md transition-colors ${M?"bg-green-600/20 text-green-400":"bg-slate-700/50 text-slate-300 hover:bg-slate-700"}`,children:M?e.jsxs(e.Fragment,{children:[e.jsx(te,{size:18})," Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:18})," Copy Invite Link"]})}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-700/50",children:[e.jsx("h3",{className:"font-semibold text-slate-300",children:"Game Options"}),r.gameOptions?.map(s=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:s.id,className:"text-sm font-medium text-slate-400",children:s.label}),s.type==="select"&&e.jsx("select",{id:s.id,value:W[s.id],onChange:t=>H(s.id,t.target.value),disabled:!g,className:"mt-1 block w-full px-3 py-2 text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500 disabled:bg-slate-800 disabled:text-slate-500 disabled:cursor-not-allowed",children:s.choices?.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]},s.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"font-semibold text-slate-300 flex items-center gap-2",children:[e.jsx(ne,{size:20})," Players"]}),e.jsxs("div",{className:"space-y-2 p-3 bg-slate-900/50 rounded-md min-h-[120px]",children:[d.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2.5 bg-slate-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.id==="p1"?e.jsx(oe,{size:18,className:"text-yellow-400"}):e.jsx(le,{size:18,className:"text-slate-400"}),e.jsxs("span",{className:"font-bold text-slate-100",children:[s.username," ",s.id===a?.id&&e.jsx("span",{className:"text-xs text-cyan-400",children:"(You)"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Score"}),e.jsx("p",{className:"text-xl font-mono font-bold text-cyan-300",children:l?.scores?.[s.id]??0})]})]},s.id)),B()]})]})]}),e.jsxs("div",{className:"pt-6 border-t border-slate-700 flex flex-col md:flex-row-reverse gap-3",children:[g?e.jsxs("button",{onClick:L,className:"w-full md:w-auto flex items-center justify-center gap-2 px-8 py-3 text-lg font-semibold text-slate-900 bg-green-500 rounded-lg hover:bg-green-400 transition transform hover:scale-105 disabled:bg-slate-600 disabled:text-slate-400 disabled:cursor-not-allowed disabled:scale-100",disabled:!V,children:[e.jsx($,{size:20})," Start Game"]}):e.jsx("p",{className:"w-full text-center text-slate-400 p-3",children:"Waiting for the host to start the game..."}),e.jsxs("button",{onClick:Y,className:"w-full md:w-auto flex-shrink-0 flex items-center justify-center gap-2 px-4 py-2 font-semibold text-slate-300 bg-slate-700/50 rounded-lg hover:bg-slate-700/80 hover:text-red-400 transition",children:[e.jsx(re,{size:16})," Leave Lobby"]})]})]})};export{ye as default};
