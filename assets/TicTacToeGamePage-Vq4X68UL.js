import{a as $,b as R,r as n,c as Y,u as D,j as e}from"./index-DOC7akpt.js";import{T as U,L as J}from"./TicTacToeBoard-8Z1a9G3M.js";import{c as h}from"./createLucideIcon-CVDLQriA.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],V=h("check",q);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],K=h("copy",F);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],X=h("loader",Q);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],ee=h("play",Z);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],se=h("users",te);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],ne=h("wifi-off",ae),re=()=>{const{gameId:l,gameName:g,gameInfo:c,playerId:x,players:b,gamePhase:S,gameState:j,createGame:d,joinGame:s,leaveGame:f,notifyLeave:r,setMyUsername:i,performAction:a,startGame:m,playAgain:u,returnToLobby:v,resetSession:L}=$(),{isHost:T,peerConnectionStates:C}=R(),N=n.useMemo(()=>b.find(P=>P.id===x),[b,x]);return{gameId:l,gameName:g,gameInfo:c,playerId:x,players:b,gamePhase:S,gameState:j,isHost:T,peerConnectionStates:C,localPlayer:N,createGame:d,joinGame:s,leaveGame:f,notifyLeave:r,setMyUsername:i,performAction:a,startGame:m,playAgain:u,returnToLobby:v,resetSession:L}},ce=()=>{const{gameName:l,gameId:g}=Y(),c=D(),[x,b]=n.useState(!1),[S,j]=n.useState(!1),{gameId:d,gameInfo:s,gamePhase:f,gameState:r,players:i,localPlayer:a,isHost:m,peerConnectionStates:u,joinGame:v,leaveGame:L,setMyUsername:T,startGame:C,returnToLobby:N,performAction:P,resetSession:_}=re(),[I,E]=n.useState(a?.username||""),z=$(t=>t.disconnectionMessage),[p,k]=n.useState("LOBBY");n.useEffect(()=>{f==="in-game"?k("GAME"):f==="post-game"&&p==="GAME"?k("SHOWING_RESULT"):f==="lobby"&&k("LOBBY")},[f,p]),n.useEffect(()=>{if(p==="SHOWING_RESULT"){const t=setTimeout(()=>{m&&N(),k("LOBBY")},1e3);return()=>clearTimeout(t)}},[p,m,N]),n.useEffect(()=>{a?.username&&E(a.username)},[a?.username]),n.useEffect(()=>{(async()=>{g&&l&&!d&&!x&&await v(g,l)==="failed"&&c(`/game/${l}`,{replace:!0})})()},[g,l,d,v,x,c]),n.useEffect(()=>{z&&d&&(c(`/game/${l}`,{replace:!0}),_())},[z,d,l,c,_]);const A=async()=>{b(!0),await L(),c(`/game/${l}`,{replace:!0})},O=()=>{I.trim()&&T(I.trim())},B=()=>{navigator.clipboard.writeText(window.location.href).then(()=>{j(!0),setTimeout(()=>j(!1),2e3)})},w=n.useMemo(()=>!s||!r?{message:"",isGameOver:!1,isMyTurn:!1}:{message:s.getGameStatus(r,i),isGameOver:s.isGameOver(r),isMyTurn:s.isTurnOf(r,a?.id||"")},[r,s,i,a]),W=n.useMemo(()=>{if(!s||i.length<s.minPlayers)return!1;if(!m)return u.get("p1")==="connected";const t=i.filter(o=>o.id!==a?.id).map(o=>o.id);return t.length===0&&s.minPlayers>1?!1:t.every(o=>u.get(o)==="connected")},[i,s,m,a,u]),H=()=>{if(!s)return null;if(Array.from(u.values()).some(y=>y==="connecting"))return e.jsxs("div",{className:"flex items-center justify-center gap-2 text-center text-cyan-400 p-2",children:[e.jsx(X,{className:"animate-spin",size:20})," ",e.jsx("span",{children:"Connecting to player..."})]});const o=Array.from(u.values()).some(y=>y==="disconnected"||y==="failed");return i.length<s.minPlayers&&o?e.jsxs("div",{className:"flex items-center justify-center gap-2 text-center text-red-400 p-2",children:[e.jsx(ne,{size:20})," ",e.jsx("span",{children:"Player disconnected."})]}):i.length<s.minPlayers?e.jsx("li",{className:"text-center text-slate-400 p-2",children:"Waiting for another player..."}):null};if(!d||!s||!a)return e.jsx("div",{className:"text-xl",children:"Joining game..."});if(p==="SHOWING_RESULT"){const{winner:t,playerMap:o}=r,y=o[a.id];let M="",G="text-white";return t==="draw"?(M="It's a Draw!",G="text-yellow-400"):t===y?(M="You Win!",G="text-green-400"):(M="You Lose!",G="text-red-400"),e.jsxs("div",{className:"relative",children:[e.jsx(U,{gameState:r,statusMessage:w.message,isGameOver:!0,isMyTurn:!1,onPerformAction:()=>{},onLeaveGame:()=>{}}),e.jsx("div",{className:"absolute inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center transition-opacity duration-300",children:e.jsx("div",{className:"bg-slate-800 p-12 rounded-2xl shadow-2xl border border-slate-700 animate-in fade-in zoom-in-95",children:e.jsx("h2",{className:`text-4xl text-center font-black ${G}`,children:M})})})]})}return p==="GAME"?e.jsx(U,{gameState:r,statusMessage:w.message,isGameOver:w.isGameOver,isMyTurn:w.isMyTurn,onPerformAction:P,onLeaveGame:A}):e.jsxs("div",{className:"w-full max-w-lg p-8 space-y-6 bg-slate-800 rounded-2xl shadow-2xl shadow-slate-950/50 border border-slate-700",children:[e.jsxs("h2",{className:"text-3xl font-bold text-center text-white capitalize",children:[s.displayName," Lobby"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-3 bg-slate-900/50 rounded-md text-center",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Share Game Link"}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-1",children:[e.jsx("p",{className:"font-mono text-lg text-cyan-400 break-all",children:window.location.href}),e.jsx("button",{onClick:B,className:"p-1.5 text-slate-400 hover:text-white transition",children:S?e.jsx(V,{size:18,className:"text-green-400"}):e.jsx(K,{size:18})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{htmlFor:"username",className:"font-semibold text-slate-300",children:"Your Username"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"username",type:"text",value:I,onChange:t=>E(t.target.value),onBlur:O,onKeyDown:t=>t.key==="Enter"&&O(),className:"flex-grow px-3 py-2 text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500"}),e.jsx("button",{onClick:O,className:"px-4 py-2 font-semibold text-white bg-cyan-600 rounded-md hover:bg-cyan-500 transition",children:"Save"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-slate-300 flex items-center gap-2",children:[e.jsx(se,{size:20})," Players"]}),e.jsxs("ul",{className:"space-y-2 p-3 bg-slate-900/50 rounded-md min-h-[80px]",children:[i.map(t=>e.jsxs("li",{className:"flex items-center justify-between p-2 bg-slate-700/50 rounded",children:[e.jsx("span",{className:"font-bold text-slate-100",children:t.username}),e.jsx("span",{className:"text-xl font-mono font-bold px-3 py-1 bg-slate-600 text-cyan-300 rounded-md",children:r?.scores?.[t.id]??0})]},t.id)),H()]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-slate-700 space-y-3",children:[m?e.jsxs("button",{onClick:C,className:"w-full flex items-center justify-center gap-2 px-4 py-3 text-lg font-semibold text-black bg-green-400 rounded-md hover:bg-green-300 transition transform hover:scale-105 disabled:bg-slate-600 disabled:cursor-not-allowed disabled:scale-100",disabled:!W,children:[e.jsx(ee,{size:20})," Start Game"]}):e.jsx("p",{className:"text-center text-slate-400",children:"Waiting for the host to start the game..."}),e.jsxs("button",{onClick:A,className:"w-full flex items-center justify-center gap-2 px-4 py-2 font-semibold text-slate-300 bg-transparent rounded-md hover:bg-red-600/20 hover:text-red-400 transition",children:[e.jsx(J,{size:16})," Leave Game"]})]})]})};export{ce as default};
