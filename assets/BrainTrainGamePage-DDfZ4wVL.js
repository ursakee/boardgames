import{b as B,u as J,r as a,a as A,j as e}from"./index-BNU-2lbw.js";import{u as F,L as Y,P as H}from"./useGameSession-7Jfc03sH.js";import W from"./BrainTrainBoard-XR-_i5wf.js";import{I as q}from"./info-DIFNUGaH.js";import{S as D,C as K,a as Q,U as V}from"./users-BrThvVER.js";import{L as X}from"./log-out-iv88Jyo1.js";import"./x-Bd3z_Nl2.js";const le=()=>{const{gameName:r,gameId:u}=B(),o=J(),{gameId:c,gameInfo:i,gamePhase:m,gameState:d,gameOptions:L,players:l,localPlayer:n,isHost:g,joinGame:p,leaveGame:T,setMyUsername:P,setGameOptions:I,startGame:M,performAction:k,resetSession:h}=F(),[b,O]=a.useState(!1),[x,j]=a.useState(n?.username||""),[y,v]=a.useState(!1),[N,w]=a.useState(null),f=a.useRef(l),G=A(s=>s.disconnectionMessage);a.useEffect(()=>{G&&c&&(o(`/game/${r}`,{replace:!0}),h())},[G,c,r,o,h]),a.useEffect(()=>{n?.username&&j(n.username)},[n?.username]),a.useEffect(()=>{if(m==="in-game"&&f.current.length>l.length){const s=f.current.find(t=>!l.some($=>$.id===t.id));if(s){w(`${s.username} has left the game.`);const t=setTimeout(()=>w(null),4e3);return()=>clearTimeout(t)}}f.current=l},[l,m]),a.useEffect(()=>{(async()=>{u&&r&&!c&&!b&&await p(u,r)==="failed"&&o(`/game/${r}`,{replace:!0})})()},[u,r,c,p,b,o]);const C=a.useMemo(()=>!i||!d||!n?{message:"",isMyTurn:!1}:{message:i.getGameStatus(d,l),isMyTurn:i.isTurnOf(d,n.id)},[i,d,l,n]);if(!c||!i||!n)return e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(Y,{className:"animate-spin h-12 w-12 text-cyan-400"}),e.jsx("p",{className:"mt-4 text-xl text-slate-300",children:"Joining Game..."})]});const z=d,S=async()=>{O(!0);const s=r;await T(),o(s?`/game/${s}`:"/",{replace:!0})},E=()=>P(x.trim()),U=(s,t)=>I({[s]:t}),R=()=>{navigator.clipboard.writeText(window.location.href).then(()=>{v(!0),setTimeout(()=>v(!1),2e3)})};return m==="in-game"||m==="post-game"?e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[N&&e.jsxs("div",{className:"fixed top-5 right-5 z-50 bg-slate-700 text-white p-4 rounded-lg shadow-lg flex items-center gap-3 animate-in fade-in slide-in-from-top-5",children:[e.jsx(q,{className:"h-5 w-5 text-cyan-400"}),e.jsx("p",{children:N})]}),e.jsx(W,{gameState:z,isGameOver:m==="post-game",onPerformAction:k,onLeaveGame:S,statusMessage:C.message,isMyTurn:C.isMyTurn})]}):e.jsxs("div",{className:"w-full max-w-2xl p-6 md:p-8 space-y-6 bg-slate-800 rounded-2xl shadow-2xl shadow-slate-950/50 border border-slate-700",children:[e.jsxs("h2",{className:"text-3xl font-bold text-white text-center border-b border-slate-700 pb-4",children:[i.displayName," Lobby"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-x-8 gap-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-slate-300",children:"Your Settings"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:s=>j(s.target.value),className:"flex-grow px-3 py-2 text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Enter your name..."}),e.jsx("button",{onClick:E,disabled:!x.trim(),className:"p-2 text-slate-300 bg-slate-700/50 rounded-md hover:bg-slate-700 disabled:opacity-50",children:e.jsx(D,{size:20})})]}),e.jsx("button",{onClick:R,className:`w-full flex items-center justify-center gap-2 px-4 py-2 font-semibold rounded-md transition-colors ${y?"bg-green-600/20 text-green-400":"bg-slate-700/50 text-slate-300 hover:bg-slate-700"}`,children:y?e.jsxs(e.Fragment,{children:[e.jsx(K,{size:18})," Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:18})," Copy Invite Link"]})}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-700/50",children:[e.jsx("h3",{className:"font-semibold text-slate-300",children:"Game Options"}),i.gameOptions?.map(s=>e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-400",children:s.label}),e.jsx("select",{value:L[s.id],onChange:t=>U(s.id,t.target.value),disabled:!g,className:"mt-1 block w-full px-3 py-2 text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none disabled:bg-slate-800 disabled:text-slate-500",children:s.choices?.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]},s.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"font-semibold text-slate-300 flex items-center gap-2",children:[e.jsx(V,{size:20})," Players"]}),e.jsx("div",{className:"space-y-2 p-3 bg-slate-900/50 rounded-md min-h-[120px]",children:l.map(s=>e.jsx("div",{className:"flex items-center justify-between p-2.5 bg-slate-700/50 rounded-lg",children:e.jsxs("span",{className:"font-bold text-slate-100",children:[s.username," ",s.id===n.id&&"(You)"]})},s.id))})]})]}),e.jsxs("div",{className:"pt-6 border-t border-slate-700 flex flex-col md:flex-row-reverse gap-3",children:[g?e.jsxs("button",{onClick:M,className:"w-full md:w-auto flex items-center justify-center gap-2 px-8 py-3 text-lg font-semibold text-slate-900 bg-green-500 rounded-lg hover:bg-green-400",children:[e.jsx(H,{size:20})," Start Game"]}):e.jsx("p",{className:"w-full text-center text-slate-400 p-3",children:"Waiting for host..."}),e.jsxs("button",{onClick:S,className:"w-full md:w-auto flex items-center justify-center gap-2 px-4 py-2 font-semibold text-slate-300 bg-slate-700/50 rounded-lg hover:text-red-400",children:[e.jsx(X,{size:16})," Leave"]})]})]})};export{le as default};
