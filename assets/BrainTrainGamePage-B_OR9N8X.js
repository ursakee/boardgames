import{b as F,u as Y,r,a as H,j as e}from"./index-BBxjmWmB.js";import{u as W,L as q,P as D}from"./useGameSession-CTfiQRTB.js";import K from"./BrainTrainBoard-BrMj7mql.js";import{I as Q}from"./info-Du3JIJns.js";import{S as V,C as X,a as Z,U as _}from"./users-CMFyLxUt.js";import{L as ee}from"./log-out-CxCj6h7H.js";import"./x-BjcpBwhR.js";const oe=()=>{const{gameName:i,gameId:f}=F(),o=Y(),{gameId:c,gameInfo:l,gamePhase:d,gameState:m,gameEngine:u,gameOptions:T,players:a,localPlayer:n,isHost:x,peerConnectionStates:g,joinGame:b,leaveGame:I,setMyUsername:M,setGameOptions:k,startGame:E,performAction:O,resetSession:j}=W(),[y,z]=r.useState(!1),[p,v]=r.useState(n?.username||""),[N,w]=r.useState(!1),[C,G]=r.useState(null),h=r.useRef(a),S=H(s=>s.disconnectionMessage),U=r.useMemo(()=>{if(!l||a.length<l.minPlayers)return!1;if(l.minPlayers===1)return!0;if(!x)return g.get("p1")==="connected";const s=a.filter(t=>t.id!==n?.id).map(t=>t.id);return s.length===0&&a.length<l.minPlayers?!1:s.every(t=>g.get(t)==="connected")},[a,l,x,n,g]);r.useEffect(()=>{S&&c&&(o(`/game/${i}`,{replace:!0}),j())},[S,c,i,o,j]),r.useEffect(()=>{n?.username&&v(n.username)},[n?.username]),r.useEffect(()=>{if(d==="in-game"&&h.current.length>a.length){const s=h.current.find(t=>!a.some(J=>J.id===t.id));if(s){G(`${s.username} has left the game.`);const t=setTimeout(()=>G(null),4e3);return()=>clearTimeout(t)}}h.current=a},[a,d]),r.useEffect(()=>{(async()=>{f&&i&&!c&&!y&&await b(f,i)==="failed"&&o(`/game/${i}`,{replace:!0})})()},[f,i,c,b,y,o]);const P=r.useMemo(()=>!u||!m||!n?{message:"",isMyTurn:!1}:{message:u.getGameStatus(m,a),isMyTurn:u.isTurnOf(m,n.id)},[u,m,a,n]);if(!c||!l||!n||!u)return e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(q,{className:"animate-spin h-12 w-12 text-cyan-400"}),e.jsx("p",{className:"mt-4 text-xl text-slate-300",children:"Joining Game..."})]});const R=m,L=async()=>{z(!0);const s=i;await I(),o(s?`/game/${s}`:"/",{replace:!0})},$=()=>M(p.trim()),A=(s,t)=>k({[s]:t}),B=()=>{navigator.clipboard.writeText(window.location.href).then(()=>{w(!0),setTimeout(()=>w(!1),2e3)})};return d==="in-game"||d==="post-game"?e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[C&&e.jsxs("div",{className:"fixed top-5 right-5 z-50 bg-slate-700 text-white p-4 rounded-lg shadow-lg flex items-center gap-3 animate-in fade-in slide-in-from-top-5",children:[e.jsx(Q,{className:"h-5 w-5 text-cyan-400"}),e.jsx("p",{children:C})]}),e.jsx(K,{gameState:R,isGameOver:d==="post-game",onPerformAction:O,onLeaveGame:L,statusMessage:P.message,isMyTurn:P.isMyTurn})]}):e.jsxs("div",{className:"w-full max-w-2xl p-6 md:p-8 space-y-6 bg-slate-800 rounded-2xl shadow-2xl shadow-slate-950/50 border border-slate-700",children:[e.jsxs("h2",{className:"text-3xl font-bold text-white text-center border-b border-slate-700 pb-4",children:[l.displayName," Lobby"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-x-8 gap-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-slate-300",children:"Your Settings"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:p,onChange:s=>v(s.target.value),className:"flex-grow px-3 py-2 text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Enter your name..."}),e.jsx("button",{onClick:$,disabled:!p.trim(),className:"p-2 text-slate-300 bg-slate-700/50 rounded-md hover:bg-slate-700 disabled:opacity-50",children:e.jsx(V,{size:20})})]}),e.jsx("button",{onClick:B,className:`w-full flex items-center justify-center gap-2 px-4 py-2 font-semibold rounded-md transition-colors ${N?"bg-green-600/20 text-green-400":"bg-slate-700/50 text-slate-300 hover:bg-slate-700"}`,children:N?e.jsxs(e.Fragment,{children:[e.jsx(X,{size:18})," Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:18})," Copy Invite Link"]})}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-700/50",children:[e.jsx("h3",{className:"font-semibold text-slate-300",children:"Game Options"}),l.gameOptions?.map(s=>e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-400",children:s.label}),e.jsx("select",{value:T[s.id],onChange:t=>A(s.id,t.target.value),disabled:!x,className:"mt-1 block w-full px-3 py-2 text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none disabled:bg-slate-800 disabled:text-slate-500",children:s.choices?.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]},s.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"font-semibold text-slate-300 flex items-center gap-2",children:[e.jsx(_,{size:20})," Players"]}),e.jsx("div",{className:"space-y-2 p-3 bg-slate-900/50 rounded-md min-h-[120px]",children:a.map(s=>e.jsx("div",{className:"flex items-center justify-between p-2.5 bg-slate-700/50 rounded-lg",children:e.jsxs("span",{className:"font-bold text-slate-100",children:[s.username," ",s.id===n.id&&"(You)"]})},s.id))})]})]}),e.jsxs("div",{className:"pt-6 border-t border-slate-700 flex flex-col md:flex-row-reverse gap-3",children:[x?e.jsxs("button",{onClick:E,disabled:!U,className:"w-full md:w-auto flex items-center justify-center gap-2 px-8 py-3 text-lg font-semibold text-slate-900 bg-green-500 rounded-lg hover:bg-green-400",children:[e.jsx(D,{size:20})," Start Game"]}):e.jsx("p",{className:"w-full text-center text-slate-400 p-3",children:"Waiting for host..."}),e.jsxs("button",{onClick:L,className:"w-full md:w-auto flex items-center justify-center gap-2 px-4 py-2 font-semibold text-slate-300 bg-slate-700/50 rounded-lg hover:text-red-400",children:[e.jsx(ee,{size:16})," Leave"]})]})]})};export{oe as default};
