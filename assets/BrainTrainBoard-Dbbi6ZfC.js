import{c as N,r as w,j as e}from"./index-BcBT8DeP.js";import{X as C}from"./x-CRDtMRLs.js";import{u as I,L as M,P as S,H as L}from"./useGameSession-BXvOYOOa.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}]],P=N("rectangle-horizontal",z);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],E=N("settings",A),B=({puzzle:n,gridState:u,setGridState:d,fixedTrainId:f,isGameOver:o})=>{const{grid:l,tracks:b,clues:j,trains:y}=n;w.useEffect(()=>{const t=Array(l.rows).fill(null).map(()=>Array(l.columns).fill(null));b.forEach(a=>{a.path.forEach(i=>{t[i.row][i.col]||(t[i.row][i.col]=[]),t[i.row][i.col].push({trackId:a.trackId,color:a.color,connections:U(i,a.path)})})});const r=y.find(a=>a.trainId===f);r&&r.carPositions.forEach(a=>{t[a.row][a.col]||(t[a.row][a.col]=[]),t[a.row][a.col].push({isFixedTrain:!0})}),d(t)},[n]);const s=(t,r)=>{o||d(a=>{if(!a)return null;const i=a.map(m=>[...m.map(g=>g?[...g]:null)]),c=i[t][r]||[];if(c.some(m=>m.isFixedTrain)||!c.some(m=>m.trackId))return a;const x=c.findIndex(m=>m.isUserPlacedTrain);return x>-1?c.splice(x,1):c.push({isUserPlacedTrain:!0}),i[t][r]=c,i})},h=(t,r,a)=>{t.preventDefault(),!o&&d(i=>{if(!i)return null;const c=i.map(g=>[...g.map(k=>k?[...k]:null)]),x=c[r][a]||[];if(x.some(g=>g.isFixedTrain))return i;const m=x.findIndex(g=>g.isMarked);return m>-1?x.splice(m,1):x.push({isMarked:!0}),c[r][a]=x,c})};return e.jsx("div",{className:"bg-slate-900/50 p-3 rounded-lg select-none",children:e.jsxs("table",{className:"border-collapse mx-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),j.columnClues.map((t,r)=>e.jsx("th",{className:"text-2xl font-bold text-slate-300 text-center align-middle pb-1",children:t},r))]})}),e.jsx("tbody",{children:u.map((t,r)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-2xl font-bold text-slate-300 text-right pr-2",children:j.rowClues[r]}),t.map((a,i)=>e.jsx("td",{onClick:()=>s(r,i),onContextMenu:c=>h(c,r,i),className:"w-16 h-16 bg-slate-700 border-2 border-slate-600 relative",style:{cursor:o?"not-allowed":"pointer"},children:F(a)},i))]},r))})]})})};function F(n){if(!n)return null;const u=n.filter(l=>l.connections),d=n.some(l=>l.isFixedTrain),f=n.some(l=>l.isUserPlacedTrain),o=n.some(l=>l.isMarked);return e.jsxs(e.Fragment,{children:[u.map((l,b)=>e.jsx("svg",{viewBox:"0 0 100 100",className:"absolute w-full h-full top-0 left-0",children:e.jsx("path",{d:_(l.connections),stroke:l.color,strokeWidth:"10",fill:"none",strokeLinecap:"round"})},b)),(d||f)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`w-3/5 h-3/5 ${d?"bg-slate-500":"bg-slate-100"} rounded-sm`})}),o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-red-400",children:e.jsx(C,{size:50,strokeWidth:3})})]})}function U(n,u){const d=u.findIndex(o=>o.row===n.row&&o.col===n.col);if(d===-1)return[];const f=[];if(d>0){const o=u[d-1];o.row<n.row&&f.push("up"),o.row>n.row&&f.push("down"),o.col<n.col&&f.push("left"),o.col>n.col&&f.push("right")}if(d<u.length-1){const o=u[d+1];o.row<n.row&&f.push("up"),o.row>n.row&&f.push("down"),o.col<n.col&&f.push("left"),o.col>n.col&&f.push("right")}return f}function _(n){switch(n.sort().join("-")){case"down-up":return"M50,0 L50,100";case"left-right":return"M0,50 L100,50";case"down-left":return"M0,50 Q50,50 50,100";case"down-right":return"M100,50 Q50,50 50,100";case"left-up":return"M0,50 Q50,50 50,0";case"right-up":return"M100,50 Q50,50 50,0";case"up":return"M50,100 L50,0";case"down":return"M50,0 L50,100";case"left":return"M100,50 L0,50";case"right":return"M0,50 L100,50";default:return""}}const G=w.memo(B),W=({tracks:n,trains:u,fixedTrainId:d})=>{const[f,o]=w.useState(new Set);w.useEffect(()=>{o(new Set)},[u]);const l=s=>n.find(h=>h.trackId===s)?.color||"gray",b=s=>{s!==d&&o(h=>{const t=new Set(h);return t.has(s)?t.delete(s):t.add(s),t})},j=s=>d===s||f.has(s),y=[...u].sort((s,h)=>{const t=l(s.trackId),r=l(h.trackId);return t<r?-1:t>r?1:h.carsCount-s.carsCount});return e.jsx("div",{className:u.length>12?"grid grid-cols-2 gap-x-2 gap-y-1":"space-y-1",children:y.map(s=>e.jsxs("div",{onClick:()=>b(s.trainId),className:`relative p-1 rounded-md ${s.trainId!==d?"cursor-pointer hover:bg-slate-700/50":""}`,children:[e.jsx("div",{className:"flex items-center",children:Array.from({length:s.carsCount}).map((h,t)=>e.jsx(P,{className:"w-8 h-8",stroke:l(s.trackId),strokeWidth:j(s.trainId)?1:2,fill:j(s.trainId)?"transparent":l(s.trackId)},t))}),j(s.trainId)&&e.jsx("div",{className:"absolute top-1/2 left-1 -translate-y-1/2 h-0.5 bg-red-400",style:{width:`${s.carsCount*2}rem`}})]},s.trainId))})},Q=({gameState:n,isGameOver:u,isMyTurn:d,onPerformAction:f,onLeaveGame:o})=>{const{localPlayer:l,isHost:b,startGame:j,gameOptions:y,setGameOptions:s,gameInfo:h,returnToLobby:t}=I(),{puzzle:r,playerStates:a,winner:i}=n,c=l?a[l.id]:null,[x,m]=w.useState(null);w.useEffect(()=>{if(r&&c&&!x){const p=Array(r.grid.rows).fill(null).map(()=>Array(r.grid.columns).fill(null));m(p)}},[r,c,x,m]);const g=()=>{x&&d&&f({type:"SUBMIT_SOLUTION",payload:x})};if(!r||!x||!c||!l)return e.jsx(M,{className:"animate-spin h-12 w-12 text-cyan-400"});const k=()=>i?i==="incorrect"?{message:"Incorrect Submission!",color:"text-yellow-400"}:i===l.id?{message:"You Win!",color:"text-green-400"}:{message:"You Lose!",color:"text-red-400"}:{message:"",color:""},{message:v,color:T}=k();return e.jsxs("div",{className:"fixed inset-0 flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-8 p-4 bg-slate-800/50 rounded-2xl border border-slate-700/50",children:[e.jsxs("div",{className:"w-full md:w-56 p-4 bg-slate-800 rounded-xl space-y-4 self-stretch flex flex-col",children:[e.jsx("h3",{className:"text-xl font-bold text-center text-slate-200 border-b border-slate-600 pb-2",children:"Available Trains"}),e.jsx("div",{className:"flex-grow",children:e.jsx(W,{tracks:r.tracks,trains:r.trains,fixedTrainId:c.fixedTrainId})}),e.jsx("button",{onClick:g,disabled:u||c.submitted,className:"w-full px-4 py-2 font-bold text-slate-900 bg-green-500 rounded-lg hover:bg-green-400 transition disabled:bg-slate-600 disabled:cursor-not-allowed",children:"Submit Solution"}),e.jsx("button",{onClick:o,className:"w-full px-4 py-2 font-semibold text-slate-300 bg-red-800/50 rounded-lg hover:bg-red-700/80",children:"Leave Game"})]}),e.jsx("div",{className:"flex-grow flex items-center justify-center",children:e.jsx(G,{puzzle:r,gridState:x,setGridState:m,fixedTrainId:c.fixedTrainId,isGameOver:u})})]}),u&&e.jsx("div",{className:"absolute inset-0 bg-slate-900/90 backdrop-blur-sm flex flex-col items-center justify-center transition-opacity duration-300 animate-in fade-in",children:e.jsxs("div",{className:"text-center p-6 bg-slate-800/80 rounded-2xl border border-slate-700 shadow-xl",children:[e.jsx("h2",{className:`text-6xl font-black ${T}`,children:v}),b&&e.jsxs("div",{className:"mt-8 flex flex-col items-center gap-4 w-64 mx-auto",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("label",{className:"flex items-center justify-center gap-2 text-sm font-semibold text-slate-400 mb-2",children:[e.jsx(E,{size:16})," Difficulty"]}),e.jsx("select",{value:y.difficulty,onChange:p=>s({difficulty:p.target.value}),className:"w-full px-3 py-2 text-center text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500",children:h?.gameOptions?.find(p=>p.id==="difficulty")?.choices?.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]}),e.jsxs("button",{onClick:j,className:"w-full flex items-center justify-center gap-2 px-6 py-3 font-semibold text-slate-900 bg-cyan-400 rounded-lg hover:bg-cyan-300 transition-colors",children:[e.jsx(S,{size:20})," Play Again"]}),e.jsxs("button",{onClick:t,className:"w-full flex items-center justify-center gap-2 px-6 py-2 font-semibold text-slate-300 bg-slate-700/50 rounded-lg hover:bg-slate-700 transition-colors",children:[e.jsx(L,{size:18})," Back to Lobby"]})]}),!b&&e.jsx("p",{className:"mt-8 text-slate-300",children:"Waiting for host to start the next game..."})]})})]})};export{Q as default};
