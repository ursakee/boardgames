import{b as J,u as R,r as l,a as Y,j as e}from"./index-CtSHnUiN.js";import B from"./UnoBoard-BKNXlOZN.js";import{u as F,L as V,P,H as q}from"./useGameSession-DP2JpDdA.js";import{S as D,C as K,U as Q}from"./users-Dg5nvqhD.js";import{C as X}from"./check-BpSWO26n.js";import{L as Z}from"./log-out-CGALsYbf.js";const ne=()=>{const{gameName:i,gameId:u}=J(),m=R(),[h,M]=l.useState(!1),[j,y]=l.useState(!1),{gameId:x,gameInfo:r,gamePhase:v,gameState:o,gameOptions:N,players:n,localPlayer:a,isHost:c,peerConnectionStates:f,joinGame:w,leaveGame:U,setMyUsername:z,setGameOptions:I,startGame:C,returnToLobby:T,performAction:$,resetSession:k}=F(),[d,G]=l.useState(a?.username||""),L=Y(s=>s.disconnectionMessage);l.useEffect(()=>{a?.username&&G(a.username)},[a?.username]),l.useEffect(()=>{(async()=>{u&&i&&!x&&!h&&await w(u,i)==="failed"&&m(`/game/${i}`,{replace:!0})})()},[u,i,x,w,h,m]),l.useEffect(()=>{L&&x&&(m(`/game/${i}`,{replace:!0}),k())},[L,x,i,m,k]);const g=l.useMemo(()=>{if(!r||!o||!a)return{message:"",isGameOver:!1,isMyTurn:!1};const s=r.isTurnOf(o,a.id);return{message:r.getGameStatus(o,n),isGameOver:r.isGameOver(o),isMyTurn:s}},[o,r,n,a]),S=async()=>{M(!0),await U(),m(`/game/${i}`,{replace:!0})},E=()=>{d.trim()&&d.trim()!==a?.username&&z(d.trim())},O=(s,t)=>{const b=r?.gameOptions?.find(H=>H.id===s)?.type==="boolean"?t:/^\d+$/.test(t)?Number(t):t;I({[s]:b})},A=()=>{navigator.clipboard.writeText(window.location.href).then(()=>{y(!0),setTimeout(()=>y(!1),2e3)})},W=l.useMemo(()=>{if(!r||n.length<r.minPlayers)return!1;if(c){const s=n.filter(t=>t.id!==a?.id).map(t=>t.id);return s.length===0&&n.length<r.minPlayers?!1:s.every(t=>f.get(t)==="connected")}return f.get("p1")==="connected"},[n,r,c,a,f]);if(!x||!r||!a)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen",children:[e.jsx(V,{className:"animate-spin h-12 w-12 text-cyan-400"}),e.jsx("p",{className:"mt-4 text-xl text-slate-300",children:"Joining Game..."})]});if(v==="post-game"){const s=o?.winner,t=n.find(b=>b.id===s)?.username||"A player",p=s===a.id;return e.jsx("div",{className:"absolute inset-0 bg-slate-900/90 backdrop-blur-sm flex flex-col items-center justify-center transition-opacity duration-300 animate-in fade-in",children:e.jsxs("div",{className:"text-center p-8 bg-slate-800 rounded-2xl shadow-xl",children:[e.jsx("h2",{className:`text-6xl font-black ${p?"text-green-400":"text-red-400"}`,children:p?"You Win!":`${t} Wins!`}),c&&e.jsxs("div",{className:"mt-8 flex gap-4",children:[e.jsxs("button",{onClick:C,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 font-semibold text-slate-900 bg-cyan-400 rounded-lg hover:bg-cyan-300",children:[e.jsx(P,{size:20})," Play Again"]}),e.jsxs("button",{onClick:T,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 font-semibold text-slate-300 bg-slate-700 rounded-lg hover:bg-slate-600",children:[e.jsx(q,{size:20})," Back to Lobby"]})]}),!c&&e.jsx("p",{className:"mt-8 text-slate-300",children:"Waiting for host..."})]})})}return v==="in-game"?e.jsx(B,{gameState:o,statusMessage:g.message,isGameOver:g.isGameOver,isMyTurn:g.isMyTurn,onPerformAction:$,onLeaveGame:S}):e.jsxs("div",{className:"w-full max-w-2xl p-6 md:p-8 space-y-6 bg-slate-800 rounded-2xl shadow-2xl shadow-slate-950/50 border border-slate-700",children:[e.jsxs("h2",{className:"text-3xl font-bold text-white text-center border-b border-slate-700 pb-4",children:[r.displayName," Lobby"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-x-8 gap-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-slate-300",children:"Your Settings"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:d,onChange:s=>G(s.target.value),className:"flex-grow px-3 py-2 text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Enter your name..."}),e.jsx("button",{onClick:E,disabled:!d.trim()||d.trim()===a.username,className:"p-2 text-slate-300 bg-slate-700/50 rounded-md hover:bg-slate-700 disabled:opacity-50",children:e.jsx(D,{size:20})})]}),e.jsx("button",{onClick:A,className:`w-full flex items-center justify-center gap-2 px-4 py-2 font-semibold rounded-md transition-colors ${j?"bg-green-600/20 text-green-400":"bg-slate-700/50 text-slate-300 hover:bg-slate-700"}`,children:j?e.jsxs(e.Fragment,{children:[e.jsx(X,{size:18})," Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{size:18})," Copy Invite Link"]})}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-700/50",children:[e.jsx("h3",{className:"font-semibold text-slate-300",children:"Game Options"}),r.gameOptions?.map(s=>e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-400",children:s.label}),s.type==="select"&&e.jsx("select",{value:N[s.id],onChange:t=>O(s.id,t.target.value),disabled:!c,className:"mt-1 block w-full px-3 py-2 text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none disabled:bg-slate-800 disabled:text-slate-500",children:s.choices?.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),s.type==="boolean"&&e.jsxs("label",{className:"mt-2 flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:!!N[s.id],onChange:t=>O(s.id,t.target.checked),disabled:!c,className:"sr-only peer"}),e.jsx("div",{className:"relative w-11 h-6 bg-slate-600 rounded-full peer peer-focus:ring-2 peer-focus:ring-cyan-500 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-500"})]})]},s.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"font-semibold text-slate-300 flex items-center gap-2",children:[e.jsx(Q,{size:20})," Players"]}),e.jsx("div",{className:"space-y-2 p-3 bg-slate-900/50 rounded-md min-h-[120px]",children:n.map(s=>e.jsx("div",{className:"flex items-center justify-between p-2.5 bg-slate-700/50 rounded-lg",children:e.jsxs("span",{className:"font-bold text-slate-100",children:[s.username," ",s.id===a.id&&"(You)"]})},s.id))})]})]}),e.jsxs("div",{className:"pt-6 border-t border-slate-700 flex flex-col md:flex-row-reverse gap-3",children:[c?e.jsxs("button",{onClick:C,disabled:!W,className:"w-full md:w-auto flex items-center justify-center gap-2 px-8 py-3 text-lg font-semibold text-slate-900 bg-green-500 rounded-lg hover:bg-green-400 disabled:bg-slate-600 disabled:cursor-not-allowed",children:[e.jsx(P,{size:20})," Start Game"]}):e.jsx("p",{className:"w-full text-center text-slate-400 p-3",children:"Waiting for host..."}),e.jsxs("button",{onClick:S,className:"w-full md:w-auto flex items-center justify-center gap-2 px-4 py-2 font-semibold text-slate-300 bg-slate-700/50 rounded-lg hover:text-red-400",children:[e.jsx(Z,{size:16})," Leave"]})]})]})};export{ne as default};
