import{b as J,u as F,r as l,a as Y,j as e}from"./index-PWPDD1dQ.js";import{u as H,L as W,P as q}from"./useGameSession-B_NWnEaC.js";import D from"./BrainTrainBoard-CfM1n3cq.js";import{I as K}from"./info-Cx_-c4bt.js";import{S as Q,C as V,a as X,U as Z}from"./users-Es8a_JvO.js";import{L as _}from"./log-out-hl6wLXhG.js";import"./x-CRgH5BoF.js";const ie=()=>{const{gameName:i,gameId:x}=J(),o=F(),{gameId:c,gameInfo:a,gamePhase:d,gameState:m,gameOptions:L,players:n,localPlayer:r,isHost:u,peerConnectionStates:f,joinGame:h,leaveGame:T,setMyUsername:I,setGameOptions:M,startGame:k,performAction:O,resetSession:b}=H(),[j,z]=l.useState(!1),[g,y]=l.useState(r?.username||""),[v,N]=l.useState(!1),[w,C]=l.useState(null),p=l.useRef(n),G=Y(s=>s.disconnectionMessage),E=l.useMemo(()=>{if(!a||n.length<a.minPlayers)return!1;if(a.minPlayers===1)return!0;if(!u)return f.get("p1")==="connected";const s=n.filter(t=>t.id!==r?.id).map(t=>t.id);return s.length===0&&n.length<a.minPlayers?!1:s.every(t=>f.get(t)==="connected")},[n,a,u,r,f]);l.useEffect(()=>{G&&c&&(o(`/game/${i}`,{replace:!0}),b())},[G,c,i,o,b]),l.useEffect(()=>{r?.username&&y(r.username)},[r?.username]),l.useEffect(()=>{if(d==="in-game"&&p.current.length>n.length){const s=p.current.find(t=>!n.some(B=>B.id===t.id));if(s){C(`${s.username} has left the game.`);const t=setTimeout(()=>C(null),4e3);return()=>clearTimeout(t)}}p.current=n},[n,d]),l.useEffect(()=>{(async()=>{x&&i&&!c&&!j&&await h(x,i)==="failed"&&o(`/game/${i}`,{replace:!0})})()},[x,i,c,h,j,o]);const S=l.useMemo(()=>!a||!m||!r?{message:"",isMyTurn:!1}:{message:a.getGameStatus(m,n),isMyTurn:a.isTurnOf(m,r.id)},[a,m,n,r]);if(!c||!a||!r)return e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(W,{className:"animate-spin h-12 w-12 text-cyan-400"}),e.jsx("p",{className:"mt-4 text-xl text-slate-300",children:"Joining Game..."})]});const U=m,P=async()=>{z(!0);const s=i;await T(),o(s?`/game/${s}`:"/",{replace:!0})},R=()=>I(g.trim()),$=(s,t)=>M({[s]:t}),A=()=>{navigator.clipboard.writeText(window.location.href).then(()=>{N(!0),setTimeout(()=>N(!1),2e3)})};return d==="in-game"||d==="post-game"?e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[w&&e.jsxs("div",{className:"fixed top-5 right-5 z-50 bg-slate-700 text-white p-4 rounded-lg shadow-lg flex items-center gap-3 animate-in fade-in slide-in-from-top-5",children:[e.jsx(K,{className:"h-5 w-5 text-cyan-400"}),e.jsx("p",{children:w})]}),e.jsx(D,{gameState:U,isGameOver:d==="post-game",onPerformAction:O,onLeaveGame:P,statusMessage:S.message,isMyTurn:S.isMyTurn})]}):e.jsxs("div",{className:"w-full max-w-2xl p-6 md:p-8 space-y-6 bg-slate-800 rounded-2xl shadow-2xl shadow-slate-950/50 border border-slate-700",children:[e.jsxs("h2",{className:"text-3xl font-bold text-white text-center border-b border-slate-700 pb-4",children:[a.displayName," Lobby"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-x-8 gap-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-slate-300",children:"Your Settings"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:g,onChange:s=>y(s.target.value),className:"flex-grow px-3 py-2 text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Enter your name..."}),e.jsx("button",{onClick:R,disabled:!g.trim(),className:"p-2 text-slate-300 bg-slate-700/50 rounded-md hover:bg-slate-700 disabled:opacity-50",children:e.jsx(Q,{size:20})})]}),e.jsx("button",{onClick:A,className:`w-full flex items-center justify-center gap-2 px-4 py-2 font-semibold rounded-md transition-colors ${v?"bg-green-600/20 text-green-400":"bg-slate-700/50 text-slate-300 hover:bg-slate-700"}`,children:v?e.jsxs(e.Fragment,{children:[e.jsx(V,{size:18})," Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{size:18})," Copy Invite Link"]})}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-700/50",children:[e.jsx("h3",{className:"font-semibold text-slate-300",children:"Game Options"}),a.gameOptions?.map(s=>e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-400",children:s.label}),e.jsx("select",{value:L[s.id],onChange:t=>$(s.id,t.target.value),disabled:!u,className:"mt-1 block w-full px-3 py-2 text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none disabled:bg-slate-800 disabled:text-slate-500",children:s.choices?.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]},s.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"font-semibold text-slate-300 flex items-center gap-2",children:[e.jsx(Z,{size:20})," Players"]}),e.jsx("div",{className:"space-y-2 p-3 bg-slate-900/50 rounded-md min-h-[120px]",children:n.map(s=>e.jsx("div",{className:"flex items-center justify-between p-2.5 bg-slate-700/50 rounded-lg",children:e.jsxs("span",{className:"font-bold text-slate-100",children:[s.username," ",s.id===r.id&&"(You)"]})},s.id))})]})]}),e.jsxs("div",{className:"pt-6 border-t border-slate-700 flex flex-col md:flex-row-reverse gap-3",children:[u?e.jsxs("button",{onClick:k,disabled:!E,className:"w-full md:w-auto flex items-center justify-center gap-2 px-8 py-3 text-lg font-semibold text-slate-900 bg-green-500 rounded-lg hover:bg-green-400",children:[e.jsx(q,{size:20})," Start Game"]}):e.jsx("p",{className:"w-full text-center text-slate-400 p-3",children:"Waiting for host..."}),e.jsxs("button",{onClick:P,className:"w-full md:w-auto flex items-center justify-center gap-2 px-4 py-2 font-semibold text-slate-300 bg-slate-700/50 rounded-lg hover:text-red-400",children:[e.jsx(_,{size:16})," Leave"]})]})]})};export{ie as default};
