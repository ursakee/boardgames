import{c as $,b as K,u as q,r as o,a as Q,j as e}from"./index-CtSHnUiN.js";import I from"./TicTacToeBoard-Cg5jhdmQ.js";import{u as X,L as E,P as A,H as Z}from"./useGameSession-DP2JpDdA.js";import{S as ee,C as se,U as te}from"./users-Dg5nvqhD.js";import{C as ae}from"./check-BpSWO26n.js";import{S as ne}from"./swords-BEISq_UD.js";import{L as re}from"./log-out-CGALsYbf.js";import"./x-DXOxZNQT.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],ie=$("shield",le);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],ce=$("wifi-off",oe),be=()=>{const{gameName:c,gameId:j}=K(),x=q(),[v,N]=o.useState(!1),[w,M]=o.useState(!1),{gameId:h,gameInfo:a,gamePhase:p,gameState:n,gameOptions:U,players:d,localPlayer:r,isHost:f,peerConnectionStates:b,joinGame:C,leaveGame:k,setMyUsername:W,setGameOptions:D,startGame:G,returnToLobby:_,performAction:L,resetSession:S}=X(),[g,T]=o.useState(r?.username||""),[F,y]=o.useState(null),O=Q(s=>s.disconnectionMessage);o.useEffect(()=>{r?.username&&T(r.username)},[r?.username]),o.useEffect(()=>{(async()=>{j&&c&&!h&&!v&&await C(j,c)==="failed"&&x(`/game/${c}`,{replace:!0})})()},[j,c,h,C,v,x]),o.useEffect(()=>{O&&h&&(x(`/game/${c}`,{replace:!0}),S())},[O,h,c,x,S]);const u=o.useMemo(()=>{if(!a||!n)return{message:"",isGameOver:!1,isMyTurn:!1};const s=a.isTurnOf(n,r?.id||"");return{message:a.getGameStatus(n,d),isGameOver:a.isGameOver(n),isMyTurn:s}},[n,a,d,r,p]);o.useEffect(()=>{if(p!=="in-game"||!n||u.isGameOver){y(null);return}const s=n.options?.turnTimer;if(s<=0){y(null);return}y(s);const t=setInterval(()=>{y(l=>{if(l===null||l<=1){if(clearInterval(t),u.isMyTurn){const m=n.board.map((i,B)=>i===null?B:null).filter(i=>i!==null);if(m.length>0){const i=m[Math.floor(Math.random()*m.length)];L({type:"MAKE_MOVE",payload:i})}}return null}return l-1})},1e3);return()=>clearInterval(t)},[n?.isNext,p,u.isGameOver]);const P=async()=>{N(!0),await k(),x(`/game/${c}`,{replace:!0})},R=async()=>{N(!0),await k(),x(`/game/${c}`,{replace:!0})},z=()=>{g.trim()&&g.trim()!==r?.username&&W(g.trim())},Y=(s,t)=>{const l=/^\d+$/.test(t)?Number(t):t;D({[s]:l})},H=()=>{navigator.clipboard.writeText(window.location.href).then(()=>{M(!0),setTimeout(()=>M(!1),2e3)})},J=o.useMemo(()=>{if(!a||d.length<a.minPlayers)return!1;if(!f)return b.get("p1")==="connected";const s=d.filter(t=>t.id!==r?.id).map(t=>t.id);return s.length===0&&a.minPlayers>1?!1:s.every(t=>b.get(t)==="connected")},[d,a,f,r,b]),V=()=>{if(!a)return null;if(Array.from(b.values()).some(l=>l==="connecting"))return e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-cyan-400 p-2",children:[e.jsx(E,{className:"animate-spin",size:16})," Connecting to player..."]});const t=Array.from(b.values()).some(l=>l==="disconnected"||l==="failed");return d.length<a.minPlayers&&t?e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-red-400 p-2",children:[e.jsx(ce,{size:16})," Player disconnected. Waiting for a new player."]}):d.length<a.minPlayers?e.jsx("div",{className:"text-center text-sm text-slate-400 p-2",children:"Waiting for another player..."}):null};if(!h||!a||!r)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen",children:[e.jsx(E,{className:"animate-spin h-12 w-12 text-cyan-400"}),e.jsx("p",{className:"mt-4 text-xl text-slate-300",children:"Joining Game..."})]});if(p==="post-game"){const{winner:s,playerMap:t}=n,l=t[r.id];let m="",i="text-white";return s==="draw"?(m="It's a Draw!",i="text-yellow-400"):s===l?(m="You Win!",i="text-green-400"):(m="You Lose!",i="text-red-400"),e.jsxs("div",{className:"relative w-full flex items-center justify-center",children:[e.jsx(I,{gameState:n,statusMessage:u.message,isGameOver:!0,isMyTurn:!1,turnTimeLeft:null,onPerformAction:()=>{},onLeaveGame:P}),e.jsx("div",{className:"absolute inset-0 bg-slate-900/90 backdrop-blur-sm flex flex-col items-center justify-center transition-opacity duration-300 animate-in fade-in",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:`text-6xl font-black ${i}`,children:m}),f&&e.jsxs("div",{className:"mt-8 flex gap-4",children:[e.jsxs("button",{onClick:G,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 font-semibold text-slate-900 bg-cyan-400 rounded-lg hover:bg-cyan-300 transition-transform hover:scale-105",children:[e.jsx(A,{size:20})," Play Again"]}),e.jsxs("button",{onClick:_,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 font-semibold text-slate-300 bg-slate-700 rounded-lg hover:bg-slate-600 transition",children:[e.jsx(Z,{size:20})," Back to Lobby"]})]}),!f&&e.jsx("p",{className:"mt-8 text-slate-300",children:"Waiting for the host to start the next round..."})]})})]})}return p==="in-game"?e.jsx(I,{gameState:n,statusMessage:u.message,isGameOver:u.isGameOver,isMyTurn:u.isMyTurn,turnTimeLeft:F,onPerformAction:L,onLeaveGame:P}):e.jsxs("div",{className:"w-full max-w-2xl p-6 md:p-8 space-y-6 bg-slate-800 rounded-2xl shadow-2xl shadow-slate-950/50 border border-slate-700",children:[e.jsx("div",{className:"text-center border-b border-slate-700 pb-4",children:e.jsxs("h2",{className:"text-3xl font-bold text-white",children:[" ",a.displayName," Lobby "]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-x-8 gap-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-slate-300",children:"Your Settings"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"username",className:"text-sm font-medium text-slate-400",children:"Display Name"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"username",type:"text",value:g,onChange:s=>T(s.target.value),onKeyDown:s=>s.key==="Enter"&&z(),className:"flex-grow px-3 py-2 text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Enter your name..."}),e.jsx("button",{onClick:z,disabled:g.trim()===""||g.trim()===r.username,className:"p-2 text-slate-300 bg-slate-700/50 rounded-md hover:bg-slate-700 disabled:bg-slate-600 disabled:text-slate-500 disabled:cursor-not-allowed transition-colors",children:e.jsx(ee,{size:20})})]})]}),e.jsx("button",{onClick:H,className:`w-full flex items-center justify-center gap-2 px-4 py-2 font-semibold rounded-md transition-colors ${w?"bg-green-600/20 text-green-400":"bg-slate-700/50 text-slate-300 hover:bg-slate-700"}`,children:w?e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:18})," Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{size:18})," Copy Invite Link"]})}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-700/50",children:[e.jsx("h3",{className:"font-semibold text-slate-300",children:"Game Options"}),a.gameOptions?.map(s=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:s.id,className:"text-sm font-medium text-slate-400",children:s.label}),s.type==="select"&&e.jsx("select",{id:s.id,value:U[s.id],onChange:t=>Y(s.id,t.target.value),disabled:!f,className:"mt-1 block w-full px-3 py-2 text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500 disabled:bg-slate-800 disabled:text-slate-500 disabled:cursor-not-allowed",children:s.choices?.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]},s.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"font-semibold text-slate-300 flex items-center gap-2",children:[e.jsx(te,{size:20})," Players"]}),e.jsxs("div",{className:"space-y-2 p-3 bg-slate-900/50 rounded-md min-h-[120px]",children:[d.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2.5 bg-slate-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.id==="p1"?e.jsx(ie,{size:18,className:"text-yellow-400"}):e.jsx(ne,{size:18,className:"text-slate-400"}),e.jsxs("span",{className:"font-bold text-slate-100",children:[s.username," ",s.id===r?.id&&e.jsx("span",{className:"text-xs text-cyan-400",children:"(You)"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Score"}),e.jsx("p",{className:"text-xl font-mono font-bold text-cyan-300",children:n?.scores?.[s.id]??0})]})]},s.id)),V()]})]})]}),e.jsxs("div",{className:"pt-6 border-t border-slate-700 flex flex-col md:flex-row-reverse gap-3",children:[f?e.jsxs("button",{onClick:G,className:"w-full md:w-auto flex items-center justify-center gap-2 px-8 py-3 text-lg font-semibold text-slate-900 bg-green-500 rounded-lg hover:bg-green-400 transition transform hover:scale-105 disabled:bg-slate-600 disabled:text-slate-400 disabled:cursor-not-allowed disabled:scale-100",disabled:!J,children:[e.jsx(A,{size:20})," Start Game"]}):e.jsx("p",{className:"w-full text-center text-slate-400 p-3",children:"Waiting for the host to start the game..."}),e.jsxs("button",{onClick:R,className:"w-full md:w-auto flex-shrink-0 flex items-center justify-center gap-2 px-4 py-2 font-semibold text-slate-300 bg-slate-700/50 rounded-lg hover:bg-slate-700/80 hover:text-red-400 transition",children:[e.jsx(re,{size:16})," Leave Lobby"]})]})]})};export{be as default};
