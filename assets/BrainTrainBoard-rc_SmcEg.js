import{c as N,r as w,j as e}from"./index-DfdsaDLU.js";import{X as I}from"./x-DVpaUBRs.js";import{u as T,L as M,P as S,H as z}from"./useGameSession-C1MhwfMI.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],P=N("circle-x",L);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}]],E=N("rectangle-horizontal",A);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],B=N("settings",_),F=({puzzle:a,gridState:d,setGridState:u,fixedTrainId:f,isInteractable:n})=>{const{grid:o,tracks:j,clues:b,trains:y}=a;w.useEffect(()=>{const t=Array(o.rows).fill(null).map(()=>Array(o.columns).fill(null));j.forEach(l=>{l.path.forEach(s=>{t[s.row][s.col]||(t[s.row][s.col]=[]),t[s.row][s.col].push({trackId:l.trackId,color:l.color,connections:W(s,l.path)})})});const i=y.find(l=>l.trainId===f);i&&i.carPositions.forEach(l=>{t[l.row][l.col]||(t[l.row][l.col]=[]),t[l.row][l.col].push({isFixedTrain:!0})}),u(t)},[a]);const r=(t,i)=>{n&&u(l=>{if(!l)return null;const s=l.map(m=>[...m.map(p=>p?[...p]:null)]),c=s[t][i]||[];if(c.some(m=>m.isFixedTrain)||!c.some(m=>m.trackId))return l;const x=c.findIndex(m=>m.isUserPlacedTrain);return x>-1?c.splice(x,1):c.push({isUserPlacedTrain:!0}),s[t][i]=c,s})},h=(t,i,l)=>{t.preventDefault(),n&&u(s=>{if(!s)return null;const c=s.map(p=>[...p.map(k=>k?[...k]:null)]),x=c[i][l]||[];if(x.some(p=>p.isFixedTrain))return s;const m=x.findIndex(p=>p.isMarked);return m>-1?x.splice(m,1):x.push({isMarked:!0}),c[i][l]=x,c})};return e.jsx("div",{className:"bg-slate-900/50 p-3 rounded-lg select-none",children:e.jsxs("table",{className:"border-collapse mx-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),b.columnClues.map((t,i)=>e.jsx("th",{className:"text-2xl font-bold text-slate-300 text-center align-middle pb-1",children:t},i))]})}),e.jsx("tbody",{children:d.map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-2xl font-bold text-slate-300 text-right pr-2",children:b.rowClues[i]}),t.map((l,s)=>e.jsx("td",{onClick:()=>r(i,s),onContextMenu:c=>h(c,i,s),className:"w-16 h-16 bg-slate-700 border-2 border-slate-600 relative",style:{cursor:n?"pointer":"not-allowed"},children:U(l)},s))]},i))})]})})};function U(a){if(!a)return null;const d=a.filter(o=>o.connections),u=a.some(o=>o.isFixedTrain),f=a.some(o=>o.isUserPlacedTrain),n=a.some(o=>o.isMarked);return e.jsxs(e.Fragment,{children:[d.map((o,j)=>e.jsx("svg",{viewBox:"0 0 100 100",className:"absolute w-full h-full top-0 left-0",children:e.jsx("path",{d:$(o.connections),stroke:o.color,strokeWidth:"10",fill:"none",strokeLinecap:"round"})},j)),(u||f)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`w-3/5 h-3/5 ${u?"bg-slate-500":"bg-slate-100"} rounded-sm`})}),n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-red-400",children:e.jsx(I,{size:50,strokeWidth:3})})]})}function W(a,d){const u=d.findIndex(n=>n.row===a.row&&n.col===a.col);if(u===-1)return[];const f=[];if(u>0){const n=d[u-1];n.row<a.row&&f.push("up"),n.row>a.row&&f.push("down"),n.col<a.col&&f.push("left"),n.col>a.col&&f.push("right")}if(u<d.length-1){const n=d[u+1];n.row<a.row&&f.push("up"),n.row>a.row&&f.push("down"),n.col<a.col&&f.push("left"),n.col>a.col&&f.push("right")}return f}function $(a){switch(a.sort().join("-")){case"down-up":return"M50,0 L50,100";case"left-right":return"M0,50 L100,50";case"down-left":return"M0,50 Q50,50 50,100";case"down-right":return"M100,50 Q50,50 50,100";case"left-up":return"M0,50 Q50,50 50,0";case"right-up":return"M100,50 Q50,50 50,0";case"up":return"M50,100 L50,0";case"down":return"M50,0 L50,100";case"left":return"M100,50 L0,50";case"right":return"M0,50 L100,50";default:return""}}const D=w.memo(F),G=({tracks:a,trains:d,fixedTrainId:u})=>{const[f,n]=w.useState(new Set);w.useEffect(()=>{n(new Set)},[d]);const o=r=>a.find(h=>h.trackId===r)?.color||"gray",j=r=>{r!==u&&n(h=>{const t=new Set(h);return t.has(r)?t.delete(r):t.add(r),t})},b=r=>u===r||f.has(r),y=[...d].sort((r,h)=>{const t=o(r.trackId),i=o(h.trackId);return t<i?-1:t>i?1:h.carsCount-r.carsCount});return e.jsx("div",{className:"space-y-1",children:y.map(r=>e.jsxs("div",{onClick:()=>j(r.trainId),className:`relative p-1 rounded-md ${r.trainId!==u?"cursor-pointer hover:bg-slate-700/50":""}`,children:[e.jsx("div",{className:"flex items-center",children:Array.from({length:r.carsCount}).map((h,t)=>e.jsx(E,{className:"w-8 h-8",stroke:o(r.trackId),strokeWidth:b(r.trainId)?1:2,fill:b(r.trainId)?"transparent":o(r.trackId)},t))}),b(r.trainId)&&e.jsx("div",{className:"absolute top-1/2 left-1 -translate-y-1/2 h-0.5 bg-red-400",style:{width:`${r.carsCount*2}rem`}})]},r.trainId))})},q=({gameState:a,isGameOver:d,onPerformAction:u,onLeaveGame:f})=>{const{localPlayer:n,isHost:o,startGame:j,gameOptions:b,setGameOptions:y,gameInfo:r,returnToLobby:h}=T(),{puzzle:t,playerStates:i,winner:l}=a,s=n?i[n.id]:null,[c,x]=w.useState(null);w.useEffect(()=>{if(t&&s&&!c){const g=Array(t.grid.rows).fill(null).map(()=>Array(t.grid.columns).fill(null));x(g)}},[t,s,c,x]);const m=()=>{c&&!s?.submitted&&u({type:"SUBMIT_SOLUTION",payload:c})};if(!t||!c||!s||!n)return e.jsx(M,{className:"animate-spin h-12 w-12 text-cyan-400"});const p=()=>d?l===n.id?{message:"You Win!",color:"text-green-400"}:l?{message:"You Lose!",color:"text-red-400"}:{message:"It's a Draw!",color:"text-slate-300"}:{message:"",color:""},{message:k,color:v}=p(),C=s.submissionResult==="incorrect"&&!d;return e.jsxs("div",{className:"fixed inset-0 flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-8 p-4 bg-slate-800/50 rounded-2xl border border-slate-700/50 relative",children:[C&&e.jsxs("div",{className:"absolute inset-0 bg-slate-900/80 backdrop-blur-sm z-10 flex flex-col items-center justify-center rounded-2xl",children:[e.jsx(P,{className:"h-20 w-20 text-yellow-400 mb-4"}),e.jsx("h2",{className:"text-4xl font-bold text-yellow-400",children:"Incorrect Solution"}),e.jsx("p",{className:"mt-2 text-slate-300",children:"Waiting for other players to finish..."})]}),e.jsxs("div",{className:"w-full md:w-56 p-4 bg-slate-800 rounded-xl space-y-4 self-stretch flex flex-col",children:[e.jsx("h3",{className:"text-xl font-bold text-center text-slate-200 border-b border-slate-600 pb-2",children:"Available Trains"}),e.jsx("div",{className:"flex-grow",children:e.jsx(G,{tracks:t.tracks,trains:t.trains,fixedTrainId:s.fixedTrainId})}),e.jsx("button",{onClick:m,disabled:d||s.submitted,className:"w-full px-4 py-2 font-bold text-slate-900 bg-green-500 rounded-lg hover:bg-green-400 transition disabled:bg-slate-600 disabled:cursor-not-allowed",children:"Submit Solution"}),e.jsx("button",{onClick:f,className:"w-full px-4 py-2 font-semibold text-slate-300 bg-red-800/50 rounded-lg hover:bg-red-700/80",children:"Leave Game"})]}),e.jsx("div",{className:"flex-grow flex items-center justify-center",children:e.jsx(D,{puzzle:t,gridState:c,setGridState:x,fixedTrainId:s.fixedTrainId,isInteractable:!d&&!s.submitted})})]}),d&&e.jsx("div",{className:"absolute inset-0 bg-slate-900/90 backdrop-blur-sm flex flex-col items-center justify-center transition-opacity duration-300 animate-in fade-in",children:e.jsxs("div",{className:"text-center p-6 bg-slate-800/80 rounded-2xl border border-slate-700 shadow-xl",children:[e.jsx("h2",{className:`text-6xl font-black ${v}`,children:k}),o&&e.jsxs("div",{className:"mt-8 flex flex-col items-center gap-4 w-64 mx-auto",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("label",{className:"flex items-center justify-center gap-2 text-sm font-semibold text-slate-400 mb-2",children:[e.jsx(B,{size:16})," Difficulty"]}),e.jsx("select",{value:b.difficulty,onChange:g=>y({difficulty:g.target.value}),className:"w-full px-3 py-2 text-center text-white bg-slate-700 border border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500",children:r?.gameOptions?.find(g=>g.id==="difficulty")?.choices?.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))})]}),e.jsxs("button",{onClick:j,className:"w-full flex items-center justify-center gap-2 px-6 py-3 font-semibold text-slate-900 bg-cyan-400 rounded-lg hover:bg-cyan-300 transition-colors",children:[e.jsx(S,{size:20})," Play Again"]}),e.jsxs("button",{onClick:h,className:"w-full flex items-center justify-center gap-2 px-6 py-2 font-semibold text-slate-300 bg-slate-700/50 rounded-lg hover:bg-slate-700 transition-colors",children:[e.jsx(z,{size:18})," Back to Lobby"]})]}),!o&&e.jsx("p",{className:"mt-8 text-slate-300",children:"Waiting for host to start the next game..."})]})})]})};export{q as default};
